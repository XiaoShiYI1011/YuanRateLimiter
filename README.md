<div align="center"><img  src="https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/raw/master/Doc/images/logo.jpg" width="120" height="120" style="margin-bottom: 10px;"/></div>
<div align="center"><strong><span style="font-size: x-large;">YuanRateLimiter</span></strong></div>
<div align="center"><h4 align="center">ä¸æ–­æ›´æ–°è¿­ä»£ä¸­...</h4></div>
<div align="center"><p stylt="text-align: center;">æˆ‘è§‰å¾—æ­¤é¡¹ç›®å¼€æºçš„åˆè¡·åœ¨äºï¼Œæ”¯æŒ.Netå¼€æºç”Ÿæ€çš„å‘å±•ã€‚è®©æˆ‘åº·åº·è°è¿˜è¯´.Netæ²¡ç”Ÿæ€çš„ğŸ˜</p></div>

### âœ¨å¦‚æœæ‚¨è§‰å¾—æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å³ä¸Šè§’ "Star" æ”¯æŒä¸€ä¸‹è°¢è°¢

æœ¬å·¥ä½œå®¤å¼€æºé¡¹ç›®ï¼š[ASP.NET Core é™æµä¸­é—´ä»¶](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter)ã€[è‡ªæ¯æœºåˆ¶](https://gitee.com/XiaoShiYi-1011/self-destruct)

## ğŸ‡æ¡†æ¶ä»‹ç»

YuanRateLimiteræ˜¯ä¸€ä¸ªAsp.Net Coreçš„é™æµä¸­é—´ä»¶ã€‚å¦‚æœä½ é¡¹ç›®ä¸æƒ³é‡‡ç”¨å›½å¤–çš„é™æµç»„ä»¶é‚£å°±å¯ä»¥å‚è€ƒæ­¤é¡¹ç›®æˆ–è€…ç›´æ¥ä½¿ç”¨ï¼Œé…ç½®çµæ´»ï¼šé€šè¿‡appsettings.jsonæ–‡ä»¶é…ç½®ï¼Œæ”¯æŒå…¨æ¥å£é™æµã€Methodé™æµã€Actionæ¥å£é™æµã€‚æ”¯æŒä»¤ç‰Œæ¡¶é™æµã€æ¼æ¡¶é™æµã€æ»‘åŠ¨çª—å£é™æµã€‚é»˜è®¤é‡‡ç”¨åŸºäºRedisçš„ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œæ”¯æŒRediså’ŒMemoryCacheçš„æ— ç¼åˆ‡æ¢ã€‚æ­£åœ¨é›†æˆå…¶ä»–é™æµç®—æ³•ã€‚é‡‡ç”¨[NewLife.Redis](https://github.com/NewLifeX/NewLife.Redis)é«˜æ€§èƒ½Rediså®¢æˆ·ç«¯ç»„ä»¶ã€‚æ ¸å¿ƒä»£ç æ³¨é‡Šè¦†ç›–ç‡>90%ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯NET 7/8è‡ªå¸¦äº†å®Œå–„çš„é™æµä¸­é—´ä»¶ï¼Œå‹æƒ…é“¾æ¥ï¼š[ASP.NET Core ä¸­çš„é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶ | Microsoft Learn](https://learn.microsoft.com/zh-cn/aspnet/core/performance/rate-limit?view=aspnetcore-8.0)ã€‚å¦‚æœä½ æ˜¯NET 7/8åŠä»¥ä¸Šå¼€å‘çš„é¡¹ç›®ï¼Œè¯·ä½¿ç”¨NET 7/8è‡ªå¸¦çš„é™æµä¸­é—´ä»¶ã€‚æ¸©é¦¨æç¤ºï¼šè¯¥é¡¹ç›®æš‚æœªå¼€å‘æˆç†Ÿï¼Œè¯·å‹¿ç›´æ¥ç”¨äºç”Ÿäº§é¡¹ç›®ã€‚

## ğŸ§¾æ›´æ–°æ—¥å¿—

- v2.3.3
    - ã€BUGã€‘[**ç´§æ€¥ä¿®å¤**ï¼šè¡¥å……æ»‘åŠ¨çª—å£é™æµè§„åˆ™](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/commit/ce312b9ffac601cd2048bef0347c272ec51ea3c0)

- ~~v2.3.2~~ï¼ˆå¿˜è®°åŠ æ»‘åŠ¨çª—å£çš„é™æµè§„åˆ™äº†ï¼‰
    - ã€BUGã€‘[ä¿®å¤é»‘ç™½åå•ä¸ºç©ºæ—¶æŠ¥é”™](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/commit/8ec4b8ff97e87c1e2d33eaf17fa7d8a20fddf797)
    - ã€BUGã€‘[ä¿®å¤é”€æ¯æ—¶æ— æ³•åˆ é™¤ç¼“å­˜çš„é—®é¢˜](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/commit/736ff5ca919c865155c950ab3d11a0831606532f)
    - ã€ADDã€‘æ–°å¢æ»‘åŠ¨çª—å£é™æµç®—æ³•

- v2.2.1
    - ã€UPDATEã€‘ä½¿ç”¨çº¯çš„NewLife.Redisï¼Œä¸ä½¿ç”¨å°è£…è¿‡çš„
    - ã€BUGã€‘[ä¿®å¤æ³›å‹ç±»å‹é”™è¯¯é—®é¢˜](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/commit/e55a00a302e2ea5600a8804e3a14661ebba52f8f)
    - ã€ADDã€‘æ–°å¢.NET Core 5 åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬çš„æ”¯æŒ
- v2.1.0
    - ã€UPDATEã€‘ä¿®æ”¹è§¦å‘é™æµçš„æç¤ºæ¶ˆæ¯ ==> The request is too frequent, please try again later.
    - ã€ADDã€‘<u>æ–°å¢IPé»‘/ç™½åå•</u>
    - ã€ADDã€‘<u>æ–°å¢IPé™æµ</u>
- v2.0.0
    - ã€UPDATEã€‘<u>é‡æ„ä»¤ç‰Œæ¡¶ç®—æ³•</u>
    - ã€UPDATEã€‘è§¦å‘é™æµåçš„æ—¥å¿—æ—¶é—´ä¿¡æ¯å¢åŠ åˆ°æ¯«ç§’
    - ã€ADDã€‘<u>æ–°å¢æ¼æ¡¶é™æµç®—æ³•</u>
- ~~v1.1.1ã€å¼ƒç”¨ã€‘~~
    - ã€ADDã€‘å°è£…Rediså’ŒMemoryCacheçš„Listæ“ä½œï¼Œä»¥ä¾¿é›†æˆæ¼æ¡¶é™æµç®—æ³•
    - ã€UPDATEã€‘ä»¤ç‰Œæ¡¶ç®—æ³•çš„ç¼“å­˜Keyè¿‡æœŸæ—¶é—´è®¾ç½®ä¸º5åˆ†é’Ÿ
- ~~v1.1.0ã€å¼ƒç”¨ã€‘~~
    - ã€UPDATEã€‘<u>é‡æ„é™æµé…ç½®ç±»ï¼Œä½¿å…¶æ›´åŠ æ˜“è¯»ã€æ˜“é…ç½®ï¼Œæ·»åŠ äº†é»˜è®¤å€¼</u>
    - ã€UPDATEã€‘ä¿®æ”¹é™æµä¸­é—´ä»¶æ‰©å±•ï¼Œä»¥ä¾¿æ”¯æŒåˆ‡æ¢é™æµç®—æ³•
    - ã€BUGã€‘ä¿®å¤ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æˆ–è€…è´Ÿè½½å‡è¡¡çš„æƒ…å†µä¸‹ï¼Œæ— æ³•è·å–çœŸå®IPçš„æƒ…å†µ
    - ã€ADDã€‘<u>MemoryCacheçš„æ”¯æŒ</u>
- ~~v1.0.2ã€å¼ƒç”¨ã€‘~~
    - ã€UPDATEã€‘é‡æ„é™æµä¸­é—´ä»¶å’Œé™æµä¸­é—´ä»¶æ‰©å±•ï¼Œä¸ºé›†æˆæ¼æ¡¶é™æµç®—æ³•åšå‡†å¤‡

## ğŸ“‘æ›´æ–°è®¡åˆ’

-  é›†æˆå›ºå®šçª—å£ç®—æ³•ğŸ› 
-  å®Œå–„ä½¿ç”¨æ–‡æ¡£âœ”
-  é›†æˆæ»‘åŠ¨çª—å£ç®—æ³•âœ”
-  å¼€å‘.NET Standard 2.0ç‰ˆæœ¬ï¼Œä»¥ä¾¿æ‰€æœ‰.NETç‰ˆæœ¬ä¸‹è½½ä½¿ç”¨âœ”
-  ~~Frameworkç‰ˆæœ¬çš„æ”¯æŒğŸ› ~~
-  ~~.NET Core 6.0ä»¥ä¸‹ç‰ˆæœ¬çš„é€‚é…ğŸ› ~~
-  å¢åŠ é’ˆå¯¹IPé™æµâœ”
-  é›†æˆæ¼æ¡¶é™æµç®—æ³•âœ”
-  MemoryCacheçš„æ”¯æŒâœ”
-  å‘å¸ƒNuGetåŒ…âœ”
-  åŸºç¡€ç‰ˆæœ¬å¼€æºâœ”

## ğŸ‘¨â€ğŸ«ä½¿ç”¨æ•™ç¨‹

<div align="center"><h4 align="center"><a href="https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/blob/master/Doc/%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.md">ç‚¹å‡»æŸ¥è¯¢è¯¦ç»†ä½¿ç”¨æ–‡æ¡£</a></h4></div>

1. NuGetå®‰è£…

    ```
    NuGet\Install-Package YuanRateLimiter -Version 2.3.3
    ```

2. ä½¿ç”¨

    - NET Core 6

        ```c#
        // æ³¨å†Œé™æµä¸­é—´ä»¶
        // ä½¿ç”¨Redisï¼š
        builder.Services.AddRateLimiterSetUp(
            builder.Configuration["Redisè¿æ¥å­—ç¬¦ä¸²"], 
            config => builder.Configuration.GetSection("RateLimiteré…ç½®èŠ‚ç‚¹").Get<RateLimitingConfig>());
        // ä½¿ç”¨MemoryCacheï¼š
        builder.Services.AddRateLimiterSetUp(
            config => builder.Configuration.GetSection("RateLimiteré…ç½®èŠ‚ç‚¹").Get<RateLimitingConfig>());
        
        // ä½¿ç”¨é™æµä¸­é—´ä»¶
        app.UseRateLimitMiddleware();
        ```

    - NET Core 5 åŠä»¥ä¸‹

        ```c#
        public class Startup
        {
            public IConfiguration Configuration { get; }
        
            public Startup(IConfiguration configuration)
            {
                Configuration = configuration;
            }
        
            public void ConfigureServices(IServiceCollection services)
            {
                // ä½¿ç”¨Redisï¼š
                services.AddRateLimiterSetUp(
                    config => Configuration.GetSection("RateLimiter").Get<RateLimiterConfig>(),
                    Configuration["RedisConfig:Default:ConnectionString"]);
        
                // ä½¿ç”¨MemoryCacheï¼š
                //services.AddRateLimiterSetUp(
                //    config => Configuration.GetSection("RateLimiter").Get<RateLimiterConfig>());
        
                // å…¶ä»–ä»£ç ....
            }
            
            public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
            {
                // å…¶ä»–ä»£ç ....
                app.UseRouting();
                // ä½¿ç”¨é™æµä¸­é—´ä»¶
                app.UseRateLimitMiddleware();
                // å…¶ä»–ä»£ç ....
            }
        }
        ```

        

3. appsettings.jsonæ–‡ä»¶ç¤ºä¾‹

    ```json
    {
        "Logging": {
            "LogLevel": {
                "Default": "Information",
                "Microsoft.AspNetCore": "Warning"
            }
        },
        "AllowedHosts": "*",
        "RedisConfig": {
            "Default": {
                "ConnectionString": "127.0.0.1:6379,password=ydmkj.com.Redis,DefaultDatabase=0,connectTimeout=3000,connectRetry=1,syncTimeout=10000"
            }
        },
        // é™æµé…ç½®
        "RateLimiter": {
            "EnableRateLimiter": true, // æ˜¯å¦å¼€å¯é™æµ
            "HttpStatusCode": 429, // é™æµçŠ¶æ€ç ï¼Œå¯ä»¥ä¸é…ç½®ï¼Œé»˜è®¤429
            "LimitingMessage": "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ã€‚", // è§¦å‘é™æµçš„æç¤ºæ¶ˆæ¯ï¼Œå¯ä»¥ä¸é…ç½®ï¼Œé»˜è®¤æ­¤æ–‡æœ¬çš„è‹±æ–‡
            "CacheKey": "RateLimiterKey", // ç¼“å­˜Keyï¼Œå¯ä»¥ä¸é…ç½®ï¼Œé»˜è®¤RateLimiterKey
            "RateLimiterModel": "TokenBucket", // ä½¿ç”¨çš„é™æµç®—æ³•æ¨¡å‹(TokenBucketã€LeakBucketã€SlidingWindow)ï¼Œé»˜è®¤ä»¤ç‰Œæ¡¶ç®—æ³•(TokenBucket)
            "EnableIpLimiter": true, // æ˜¯å¦å¯ç”¨Ipé™æµ
            //"IpWhiteList": [ "127.0.0.1", "0.0.0.1" ], // é™æµIpç™½åå•
            "IpWhiteList": [], // é™æµIpç™½åå•
            "IpBlackList": [ "122.189.37.201" ], // é™æµIpé»‘åå•
            "RateLimiterRule": {
                "RateLimiterLogLevel": "All", // é™æµçº§åˆ«ï¼šActionã€Methodã€Allï¼Œé»˜è®¤All
                "AllFlowLimiterRule": {
                    "Capacity": 10, // å®¹é‡
                    "RateLimit": 2, // é€Ÿç‡(QPS)
                    "WindowSize": 10, // çª—å£å¤§å°
                    "MaxRequests": 10 // æœ€å¤§è¯·æ±‚æ•°
                },
                // "MethodFlowLimiterRules": [
                //     {
                //         "Method": "GET",
                //         "Capacity": 10,
                //         "RateLimit": 1
                //     },
                //     {
                //         "Method": "PUT",
                //         "Capacity": 15,
                //         "RateLimit": 1
                //     }
                // ],
                // "ActionFlowLimiterRules": [
                //     {
                //         "Path": "/api/Test/Test01",
                //         "Capacity": 10,
                //         "RateLimit": 2
                //     },
                //     {
                //         "Path": "/api/Test/Test03",
                //         "Capacity": 1000,
                //         "RateLimit": 1
                //     }
                // ]
            }
        }
    }
    ```

## ğŸ‘©â€ğŸ’»æµ‹è¯•æˆªå›¾

- APIé™æµï¼š

    ![](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/raw/master/Doc/images/Test.JPG)
    
    ![](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/raw/master/Doc/images/Test02.JPG)
    
    ![](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/raw/master/Doc/images/Test01.JPG)
    
    ![](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/raw/master/Doc/images/Test05.png)

## ğŸ¤å•†ä¸šåˆä½œ

1. æˆ‘ä»¬å›¢é˜Ÿ(å…ƒä»£ç ç§‘æŠ€å·¥ä½œå®¤)ä¸“ä¸šä»äº‹è½¯ä»¶å¼€å‘ã€ç½‘ç«™å¼€å‘ç­‰å¤šä¸ªé¢†åŸŸã€‚å¦‚æœæ‚¨æœ‰ä»¥ä¸‹éœ€æ±‚ï¼Œæ¬¢è¿ä¸æˆ‘ä»¬è”ç³»ï¼š
    - ç§»åŠ¨ç«¯åº”ç”¨ / ç”µè„‘æ¡Œé¢åº”ç”¨ / ç½‘ç«™å¼€å‘ / é¸¿è’™åº”ç”¨ / å¾®ä¿¡ã€æ”¯ä»˜å®ã€å­—èŠ‚ç­‰ç¬¬ä¸‰æ–¹å°ç¨‹åºæˆ–ç½‘ç«™å¼€å‘
    - å®šåˆ¶è§£å†³æ–¹æ¡ˆ
    - ...

1. æˆ‘ä»¬å›¢é˜Ÿ(å…ƒä»£ç ç§‘æŠ€å·¥ä½œå®¤)çš„ä¸»è¦æŠ€æœ¯æ ˆï¼š.Net ã€Vueã€Javaã€é¸¿è’™ç­‰
    - åŒ…æ‹¬ï¼šç§»åŠ¨ç«¯åº”ç”¨/ ç”µè„‘æ¡Œé¢åº”ç”¨ / ç½‘ç«™å¼€å‘ / é¸¿è’™åº”ç”¨ / å¾®ä¿¡ã€æ”¯ä»˜å®ã€å­—èŠ‚ç­‰ç¬¬ä¸‰æ–¹å°ç¨‹åºæˆ–ç½‘ç«™å¼€å‘
2. æˆ‘ä»¬æä¾›é«˜è´¨é‡çš„å¼€å‘æœåŠ¡ï¼Œæ‰€æœ‰é¡¹ç›®å•å­ï¼Œå‡ä¸ºæºç äº¤ä»˜ã€‚å¤§é‡‘é¢å•å­éœ€è¦ç­¾è®¢åˆåŒ
3. è”ç³»æ–¹å¼ï¼š[xiaoshiyi1011@163.com](mailto:xiaoshiyi1011@163.com)

##  ğŸ”ç‰ˆæƒå£°æ˜

- è¯¥é¡¹ç›®ç­¾ç½²äº†MITæˆæƒè®¸å¯ï¼Œè¯¦æƒ…è¯·å‚é˜… [LICENSE](https://gitee.com/XiaoShiYi-1011/yuan-rate-limiter/raw/master/LICENSE)ï¼Œæºç å®Œå…¨å…è´¹å¼€æºå•†ç”¨ã€‚
- ä¸èƒ½ä»¥ä»»ä½•å½¢å¼å°†è¯¥é¡¹ç›®ç”¨äºéæ³•ä¸ºç›®çš„çš„è¡Œä¸ºã€‚
- ä»»ä½•åŸºäºæœ¬è½¯ä»¶è€Œäº§ç”Ÿçš„ä¸€åˆ‡æ³•å¾‹çº çº·å’Œè´£ä»»ï¼Œå‡äºä½œè€…æ— å…³ã€‚
